<div class="container">
  <% if notice.present? %>
    <p class="py-2 px-3 bg-green-50 mb-5 text-green-500 font-medium rounded-lg inline-block" id="notice"><%= notice %></p>
  <% end %>

  <% if @user %>
    <section class="hero">
      <div class="hero-body">
        <p class="title"><%= @user.name %></p>
        <p class="subtitle">"What remains of me..."</p>
      </div>
    </section>

    <div class="columns">
      <div class="column is-one-quarter">
        <%= render partial: 'users/user_card', locals: { user: @user } %>
      </div>

      <div class="column is-three-quarters">
        <div class="columns is-multiline">
          <% @user.albums.each do |album| %>
            <div class="column is-full">
              <%= render partial: 'components/horizontal_card', locals: { album: album } %>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <script type="text/javascript">
      document.addEventListener('DOMContentLoaded', () => {
        // Functions to open and close a modal
        function openModal($el) {
          $el.classList.add('is-active');
        }

        function closeModal($el) {
          $el.classList.remove('is-active');
        }

        function closeAllModals() {
          (document.querySelectorAll('.modal') || []).forEach(($modal) => {
            closeModal($modal);
          });
        }

        // Add a click event on buttons to open a specific modal
        (document.querySelectorAll('.js-modal-trigger') || []).forEach(($trigger) => {
          const modal = $trigger.dataset.target;
          const $target = document.getElementById(modal);

          $trigger.addEventListener('click', () => {
            openModal($target);
          });
        });

        // Add a click event on various child elements to close the parent modal
        (document.querySelectorAll('.modal-background, .modal-close, .modal-card-head .delete, .modal-card-foot .button') || []).forEach(($close) => {
          const $target = $close.closest('.modal');

          $close.addEventListener('click', () => {
            closeModal($target);
          });
        });

        // Add a keyboard event to close all modals
        document.addEventListener('keydown', (event) => {
          if(event.key === "Escape") {
            closeAllModals();
          }
        });
      });

      function toggleModal(modalID){
        document.getElementById(modalID).classList.toggle("hidden");
        document.getElementById(modalID + "-backdrop").classList.toggle("hidden");
        document.getElementById(modalID).classList.toggle("flex");
        document.getElementById(modalID + "-backdrop").classList.toggle("flex");
      }
    </script>
  <% else %>
    <section class="hero is-primary">
      <div class="hero-body">
        <p class="title">Users</p>
        <p class="subtitle">Select a user and see what they have left behind.</p>
      </div>
    </section>

    <%= render partial: 'components/search_bar' %>

    <div id="users" class="container">
      <%= "No user found." if @users.empty? %>
      <%= render partial: 'components/cards', locals: { users: @users } %>
    </div>
  <% end %>
</div>
